<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Create a New Targets Pipeline for LPC • levinmisc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a New Targets Pipeline for LPC">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">levinmisc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/create-a-new-targets-pipeline-for-lpc.html">Create a New Targets Pipeline for LPC</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mglev1n/levinmisc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create a New Targets Pipeline for LPC</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mglev1n/levinmisc/blob/main/vignettes/create-a-new-targets-pipeline-for-lpc.Rmd" class="external-link"><code>vignettes/create-a-new-targets-pipeline-for-lpc.Rmd</code></a></small>
      <div class="d-none name"><code>create-a-new-targets-pipeline-for-lpc.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mglev1n/levinmisc" class="external-link">levinmisc</a></span><span class="op">)</span></span></code></pre></div>
<!-- WARNING - This vignette is generated by {fusen} from dev/LPC_targets_project.Rmd: do not edit by hand -->
<!-- 
Run this 'development' chunk

Store every call to library() that you need to run chunks line by line, as in a classical Rmd for analysis
-->
<!--
# Description of your package

This will fill the description of your package.
Fill and run the content of this chunk, before anything else. 

Note: when you will use other flat templates, this part will be in a separate file. Do not be surprised!
-->
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>targets</code> package is a tool for developing
reproducible research workflows in R. Details of the package motivation
and tools are described in detail: <a href="https://books.ropensci.org/targets/" class="external-link uri">https://books.ropensci.org/targets/</a> and <a href="https://docs.ropensci.org/targets/" class="external-link uri">https://docs.ropensci.org/targets/</a>.</p>
<div class="section level3">
<h3 id="example-workflow">Example Workflow<a class="anchor" aria-label="anchor" href="#example-workflow"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Create a new R project</p></li>
<li><p>Run the <code><a href="../reference/populate_targets_proj.html">levinmisc::populate_targets_proj()</a></code> function
in the R console - this function is described below in detail, and will
initialize your project with helpful files/folders to start building
your <code>targets</code> pipeline.</p></li>
<li><p>Modify the <code>Pipelines.qmd</code> file to specify your
analyses. The <code>targets</code> documentation can be useful for
specifics.</p></li>
<li><p>Knit/Render <code>Pipelines.qmd</code> to convert your markdown
document into a series of R scripts that will actually run your
analyses.</p></li>
<li><p>Run <code>submit-targets.sh</code> from a terminal window to
submit your <code>targets</code> pipeline to the LPC for execution.
Details of possible command line arguments to this script are described
below.</p></li>
<li><p>Modify <code>Results.qmd</code> to present the results of your
analyses. Rendering this file allows you to mix text describing your
analyses/methods and include citations alongside the actual results of
your pipeline. The <code><a href="https://docs.ropensci.org/targets/reference/tar_read.html" class="external-link">targets::tar_read()</a></code> function should be
used heavily to load pre-computed results from your pipeline.</p></li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="populate_targets_proj">populate_targets_proj()<a class="anchor" aria-label="anchor" href="#populate_targets_proj"></a>
</h2>
<p>The <code>populate_targets_proj</code> function can be run within a
new project folder to initialize the project with the files/folders
necessary for deploying a <code>targets</code> pipeline on the LPC at
Penn. This includes creating LSF templates, a <code>Pipelines.qmd</code>
file containing boilerplate for running analyses, and a
<code>Results.qmd</code> file which can be used to visualize the
results.</p>
<!--
Here is an example on how to use the function.
This should be a reproducible and working example
-->
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' \dontrun{</span></span>
<span><span class="fu"><a href="../reference/populate_targets_proj.html">populate_targets_proj</a></span><span class="op">(</span><span class="st">"test"</span><span class="op">)</span></span>
<span><span class="co">#' }</span></span></code></pre></div>
<p>The <code><a href="../reference/populate_targets_proj.html">populate_targets_proj()</a></code> function creates several
files/folders within the project directory.
<code>.make-targets.sh</code> and is a hidden helper file which is not
designed for user interaction, but necessary for submission of jobs to
the LSF scheduler. The other files are designed to be edited/used by the
user:</p>
<ul>
<li><p><code>Pipeline.qmd</code> - Quarto markdown file which can be
used to create a Target Markdown document that specifies a
<code>targets</code> pipeline for your analyses. See: <a href="https://books.ropensci.org/targets/literate-programming.html#target-markdown" class="external-link uri">https://books.ropensci.org/targets/literate-programming.html#target-markdown</a>
for details. Remember to knit/render this document in order to generate
the pipeline.</p></li>
<li><p><code>Results.qmd</code> - Quarto markdown file which can be used
to display the results generated by the <code>targets</code> pipeline
specified in <code>Pipeline.qmd</code></p></li>
<li><p><code>build_logs/</code> - Directory where jobs logs are
stored</p></li>
<li><p><code>submit-targets.sh</code>- This is a bash script which can
be used to run your <code>targets</code> pipeline, once
<code>Pipeline.qmd</code> has been knit/rendered. This script can be run
directly from the submission host.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="submit-targets-sh">submit-targets.sh<a class="anchor" aria-label="anchor" href="#submit-targets-sh"></a>
</h2>
<p>This script is used to actually submit your pipeline to the LPC once
<code>Pipeline.qmd</code> has been knit/rendered. This should be run
from a terminal session from the root directory of your project. The
only function of this script is to submit your pipeline to the LPC for
analysis, and can be run directly from a submission host (eg.
<code>scisub7</code>). The script can accept command line arguments,
which can be useful for parallelizing your pipeline over multiple
workers/CPUs:</p>
<pre><code>Usage: ./submit-targets.sh [-n NUM_WORKERS] [-j JOB_NAME] [-o OUTPUT_LOG] [-e ERROR_LOG] [-q QUEUE] [-m MEMORY] [-s SLACK] [-h HELP]

Submit a job using the LSF scheduler with the specified number of CPUs and memory usage.

Options:
  -n NUM_WORKERS Number of workers (cpu cores) to request for running the targets pipeline (default: 1)
  -j JOB_NAME    Name of the job (default: make_targets)
  -o OUTPUT_LOG  Path to the output log file (default: build_logs/targets_%J.out)
  -e ERROR_LOG   Path to the error log file (default: build_logs/targets_%J.err)
  -q QUEUE       Name of the queue to submit the job to (default: voltron_normal)
  -m MEMORY      Memory usage for the job in megabytes (default: 16000)
  -s SLACK       Enable slack notifications; requires setup using slackr::slack_setup() (default: false)
  -h HELP        Display this help message and exit</code></pre>
<div class="section level3">
<h3 id="slack-notifications">Slack Notifications<a class="anchor" aria-label="anchor" href="#slack-notifications"></a>
</h3>
<p>Slack can be used to automatically notify the user of pipeline
start/finish using the <code>-s true</code> command line flag:</p>
<pre><code>./submit-targets.sh -s true</code></pre>
<p>Slack notifications are provided using the <code>slackr</code>
package. The package must be configured separately before Slack
notifications are enabled. See <a href="https://mrkaye97.github.io/slackr/index.html" class="external-link uri">https://mrkaye97.github.io/slackr/index.html</a> for more
information about <code>slackr</code> setup and generation of an Slack
API token.</p>
<!--
Here are some unit tests to verify the function works as expected.
-->
</div>
<div class="section level3">
<h3 id="use-crew-for-parallelization">Use {crew} for parallelization<a class="anchor" aria-label="anchor" href="#use-crew-for-parallelization"></a>
</h3>
<p>The <code>crew</code> and <code>crew.cluster</code> packages have
enabled the use of heterogenous workers (<a href="https://books.ropensci.org/targets/crew.html#heterogeneous-workers" class="external-link uri">https://books.ropensci.org/targets/crew.html#heterogeneous-workers</a>),
that can be used to deploy <code>targets</code> pipelines either locally
or on HPC resources. The <code><a href="../reference/use_crew_lsf.html">use_crew_lsf()</a></code> function is
designed to return a block of code to rapidly enable the use of
heterogeneous workers on the Penn LPC. By default, this function creates
workers that submit to different queues (eg.
<code>voltron_normal</code>, <code>voltron_long</code>), and allocate
different resources (eg. a “normal” worker will use 1 core and 16GB
memory, while a “long” worker will use 1 core and 10GB memory).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' \dontrun{</span></span>
<span><span class="fu"><a href="../reference/use_crew_lsf.html">use_crew_lsf</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#' }</span></span></code></pre></div>
<!-- 
# Inflate your package

You're one inflate from paper to box.
Build your package from this very Rmd using `fusen::inflate()` 
-->
<!-- 
- Verify your `"DESCRIPTION"` file has been updated
- Verify your function is in `"R/"` directory
- Verify your test is in `"tests/testthat/"` directory
- Verify this Rmd appears in `"vignettes/"` directory 
-->
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Levin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
